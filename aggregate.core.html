<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>aggregate.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Aggregate</span> <span class="project-version">1.1.3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="aggregate.core.html"><div class="inner"><span>aggregate.core</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="aggregate.core.html#var--.3E1"><div class="inner"><span>-&gt;1</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var--.3Emn"><div class="inner"><span>-&gt;mn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var--.3En"><div class="inner"><span>-&gt;n</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-delete.21"><div class="inner"><span>delete!</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-entity"><div class="inner"><span>entity</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-extract-id"><div class="inner"><span>extract-id</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-load"><div class="inner"><span>load</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-delete-fn"><div class="inner"><span>make-delete-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-entity-options"><div class="inner"><span>make-entity-options</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-er-config"><div class="inner"><span>make-er-config</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-insert-fn"><div class="inner"><span>make-insert-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-query-.3Cmany-fn"><div class="inner"><span>make-query-&lt;many-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-query-.3Cmany.3E-fn"><div class="inner"><span>make-query-&lt;many&gt;-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-read-fn"><div class="inner"><span>make-read-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-update-fn"><div class="inner"><span>make-update-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-make-update-links-fn"><div class="inner"><span>make-update-links-fn</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-only"><div class="inner"><span>only</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-persisted.3F"><div class="inner"><span>persisted?</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-save.21"><div class="inner"><span>save!</span></div></a></li><li class="depth-1"><a href="aggregate.core.html#var-without"><div class="inner"><span>without</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">aggregate.core</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var--.3E1"><h3>-&gt;1</h3><div class="usage"><code>(-&gt;1 relation-kw entity-kw)</code><code>(-&gt;1 relation-kw entity-kw options)</code></div><div class="doc"><pre class="plaintext">Returns a relation-spec for a :one&gt; relationship.
Available options:
:fk-kw            A keyword denoting the foreign-key name.
:owned?           A boolean telling if the related entity is owned,
                  i.e. will be deleted when the owner or the link is
                  deleted. Defaults to true.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L393">view source</a></div></div><div class="public anchor" id="var--.3Emn"><h3>-&gt;mn</h3><div class="usage"><code>(-&gt;mn relation-kw entity-kw)</code><code>(-&gt;mn relation-kw entity-kw options)</code></div><div class="doc"><pre class="plaintext">Returns a relation-spec for a :&lt;many&gt; relationship.
Available options:
:query-fn         A function returning records by a foreign key.
:update-links-fn  A function for updating link table records.
:owned?           A boolean telling if the related entity is owned,
                  i.e. will be deleted when the owner or the link is
                  deleted. Defaults to false.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L430">view source</a></div></div><div class="public anchor" id="var--.3En"><h3>-&gt;n</h3><div class="usage"><code>(-&gt;n relation-kw entity-kw)</code><code>(-&gt;n relation-kw entity-kw options)</code></div><div class="doc"><pre class="plaintext">Returns a relation-spec for a :&lt;many relationship.
Available options:
:fk-kw            A keyword denoting the foreign-key name.
:query-fn         A function returning records by a foreign key.
:owned?           A boolean telling if the related entity is owned,
                  i.e. will be deleted when the owner or the link is
                  deleted. Defaults to true.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L411">view source</a></div></div><div class="public anchor" id="var-delete.21"><h3>delete!</h3><div class="usage"><code>(delete! er-config db-spec m)</code><code>(delete! er-config db-spec entity-kw m-or-id)</code></div><div class="doc"><pre class="plaintext">Removes an aggregate datastructure from the database.
Returns the number of deleted records.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L770">view source</a></div></div><div class="public anchor" id="var-entity"><h3>entity</h3><div class="usage"><code>(entity &amp; args)</code></div><div class="doc"><pre class="plaintext">Returns an entity-spec from an entity keyword, an optional
options-map and an arbitrary number of relation-specs, i.e.
    (agg/entity entity-kw options-map? relations)
Available options:
:read-fn       A function (fn [db-spec id]) returning the
               record with primary key value id as a map.
:insert-fn     A function (fn [db-spec row-map]) that inserts
               the row-map as record, and returns the row-map
               containing the new primary key value.
:update-fn     A function (fn [db-spec set-map]) that updates
               the record identified by the primary key value
               within set-map with the values of set-map.
:delete-fn     A function (fn [db-spec id]) that deletes the
               record identified by the primary key value.
:id-kw         The keyword to be used to get/assoc the primary
               key value. It is also used as primary key
               column name in default DB access functions.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L369">view source</a></div></div><div class="public anchor" id="var-extract-id"><h3>extract-id</h3><div class="usage"><code>(extract-id id-kw insert-result)</code></div><div class="doc"><pre class="plaintext">Extracts id value from results like ({:scope_identity() 2}) or ({:id 2, ...}).
</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L67">view source</a></div></div><div class="public anchor" id="var-load"><h3>load</h3><div class="usage"><code>(load er-config db-spec entity-kw id)</code><code>(load er-config db-spec m)</code></div><div class="doc"><pre class="plaintext">Loads an aggregate by `id`. The `entity-kw` denotes the aggregate root.
Returns a map containing the entity-kw in ::entity and all data, or
nil if the entity-kw is unknown or the record does not exist.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L567">view source</a></div></div><div class="public anchor" id="var-make-delete-fn"><h3>make-delete-fn</h3><div class="usage"><code>(make-delete-fn tablename id-kw)</code></div><div class="doc"><pre class="plaintext">Returns a delete function [db-spec id -&gt; (Seq id)] for a specific
table, which deletes the record id points to. It returns the number
of deleted records (usually 1), or nil if none was deleted.
The tablename may be passed as string or keyword.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L125">view source</a></div></div><div class="public anchor" id="var-make-entity-options"><h3>make-entity-options</h3><div class="usage"><code>(make-entity-options tablename)</code><code>(make-entity-options tablename id-kw)</code></div><div class="doc"><pre class="plaintext">Returns a map containing all four default JDBC based implementations
for read, insert, update and delete.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L185">view source</a></div></div><div class="public anchor" id="var-make-er-config"><h3>make-er-config</h3><div class="usage"><code>(make-er-config &amp; args)</code></div><div class="doc"><pre class="plaintext">Creates a er-config map from an optional options-map and an
arbitrary number of entity-specs, i.e.
    (agg/make-er-config options-map? entities)
Available options:
:read-fn-factory          A function (fn [tablename]) returning the
                          default read function.
:insert-fn-factory        A function (fn [tablename]) returning the
                          default insert function.
:update-fn-factory        A function (fn [tablename]) returning the
                          default update function.
:delete-fn-factory        A function (fn [tablename]) returning the
                          default delete function.
:query-&lt;many-fn-factory   A function (fn [tablename fk-kw]) returning
                          the default query-for-many function using
                          one foreign key.
:query-&lt;many&gt;-fn-factory  A function (fn [tablename linktablename fk-a fk-b])
                          returning the default query-for-many function
                          that uses a linktable.
:update-links-fn-factory  A function (fn [linktablename fk-a fk-b])
                          returning the default function to update
                          link tables.
:id-kw                    A keyword that is taken as default primary
                          key column name.
:persisted-pred-fn        A predicate (fn [db-spec entity-kw id-kw row-map])
                          that returns true if the given row-map is already
                          present in DB.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L321">view source</a></div></div><div class="public anchor" id="var-make-insert-fn"><h3>make-insert-fn</h3><div class="usage"><code>(make-insert-fn tablename id-kw)</code></div><div class="doc"><pre class="plaintext">Returns an insert function [db-spec row-map -&gt; row-map] for a specific table.
It returns the record, possibly augmented with the generated id in
an :id slot. The tablename may be passed as string or keyword.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L93">view source</a></div></div><div class="public anchor" id="var-make-query-.3Cmany-fn"><h3>make-query-&lt;many-fn</h3><div class="usage"><code>(make-query-&lt;many-fn tablename fk-kw)</code></div><div class="doc"><pre class="plaintext">Returns a finder function [db-spec id -&gt; (Seq Map)] for a specific
table, that returns -- as sequence of maps -- all records that have
id as value of the foreign key field denoted by fk-kw.
Assumes a simple n to 1 relationship.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L139">view source</a></div></div><div class="public anchor" id="var-make-query-.3Cmany.3E-fn"><h3>make-query-&lt;many&gt;-fn</h3><div class="usage"><code>(make-query-&lt;many&gt;-fn tablename linktablename fk-a fk-b)</code><code>(make-query-&lt;many&gt;-fn tablename linktablename fk-a fk-b b-id-kw)</code></div><div class="doc"><pre class="plaintext">Returns a finder function [db-spec id -&gt; (Seq Map)] for a
specific table whose records are in a m to n relationship
realized by a link table containing two foreign keys. The
function returns a sequence of maps.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L151">view source</a></div></div><div class="public anchor" id="var-make-read-fn"><h3>make-read-fn</h3><div class="usage"><code>(make-read-fn tablename id-kw)</code></div><div class="doc"><pre class="plaintext">Returns a read function [db-spec id -&gt; row-map] for a specific table.
It returns a single record or nil. The tablename may be passed as
string or keyword.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L81">view source</a></div></div><div class="public anchor" id="var-make-update-fn"><h3>make-update-fn</h3><div class="usage"><code>(make-update-fn tablename id-kw)</code></div><div class="doc"><pre class="plaintext">Returns an update function [db-spec set-map -&gt; set-map] for a
specific table, which takes a map of values and updates the record
denoted by the :id contained in set-map. It returns the set-map.
The tablename may be passed as string or keyword.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L107">view source</a></div></div><div class="public anchor" id="var-make-update-links-fn"><h3>make-update-links-fn</h3><div class="usage"><code>(make-update-links-fn linktablename fk-a fk-b)</code><code>(make-update-links-fn linktablename fk-a fk-b b-id-kw)</code></div><div class="doc"><pre class="plaintext">Returns a function that updates a link table by first deleting all
records having a-id as value in the field fk-a, and afterwards
inserting for each of the bs one record with fk-a = a-id and fk-b
= (:id b).</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L169">view source</a></div></div><div class="public anchor" id="var-only"><h3>only</h3><div class="usage"><code>(only er-config &amp; entity-relation-seqs)</code></div><div class="doc"><pre class="plaintext">Removes all relations that are NOT specified by the vectors.
A vector must begin with an entity-kw, all remaining items denote
relations.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L473">view source</a></div></div><div class="public anchor" id="var-persisted.3F"><h3>persisted?</h3><div class="usage"><code>(persisted? db-spec entity-kw id-kw m)</code></div><div class="doc"><pre class="plaintext">Returns true if the map m has already been persisted.
It is assumed that the existence of an id-kw key is enough evidence.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L74">view source</a></div></div><div class="public anchor" id="var-save.21"><h3>save!</h3><div class="usage"><code>(save! er-config db-spec m)</code><code>(save! er-config db-spec entity-kw m)</code></div><div class="doc"><pre class="plaintext">Saves an aggregate data structure to the database.
</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L714">view source</a></div></div><div class="public anchor" id="var-without"><h3>without</h3><div class="usage"><code>(without er-config &amp; entities-or-entity-relation-seqs)</code></div><div class="doc"><pre class="plaintext">Removes entities (specified by a keyword) and relations (specified
in a vector, where the first item is the entity keyword) from the er-config.</pre></div><div class="src-link"><a href="https://github.com/friemen/aggregate/blob/master/src/aggregate/core.clj#L454">view source</a></div></div></div></body></html>